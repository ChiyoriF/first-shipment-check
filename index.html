function renderTable(currentData, avgMap) {
  const threshold = Number(document.getElementById("threshold").value) / 100;

  let html = `
    <table>
      <tr>
        <th>警告種別</th>
        <th>商品名</th>
        <th>得意先名</th>
        <th>今月出荷</th>
        <th>過去6か月平均</th>
        <th>超過率</th>
      </tr>
  `;

  let hasWarning = false;

  currentData.forEach(r => {
    const customer = r["得意先名"]?.trim();
    const product = r["商品名"]?.trim();
    const qty = Number(r["出荷数量"]);

    if (!customer || !product || isNaN(qty)) return;

    const key = `${customer}__${product}`;
    const avg = avgMap[key];

    /* ① 初出荷 */
    if (!avg) {
      hasWarning = true;
      html += `
        <tr class="highlight">
          <td>⚠ 初出荷</td>
          <td>${product}</td>
          <td>${customer}</td>
          <td>${qty}</td>
          <td>―</td>
          <td>―</td>
        </tr>
      `;
      return;
    }

    /* ② 急増（30％超） */
    const rate = (qty - avg) / avg;

    if (rate > threshold) {
      hasWarning = true;
      html += `
        <tr class="highlight">
          <td>⚠ 急増</td>
          <td>${product}</td>
          <td>${customer}</td>
          <td>${qty}</td>
          <td>${avg.toFixed(1)}</td>
          <td>${Math.round(rate * 100)}%</td>
        </tr>
      `;
    }
  });

  html += "</table>";

  document.getElementById("result").innerHTML =
    hasWarning ? html : "<p>⚠ 警告対象はありません</p>";
}
